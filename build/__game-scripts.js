var GameConfig=pc.createScript("gameConfig");GameConfig.attributes.add("colorCorrect",{type:"rgba",title:"Цвет: Верно (Correct)",default:[.2,.7,.2,1]}),GameConfig.attributes.add("colorPresent",{type:"rgba",title:"Цвет: Есть, но не на месте (Present)",default:[.8,.8,.2,1]}),GameConfig.attributes.add("colorAbsent",{type:"rgba",title:"Цвет: Нет в слове (Absent)",default:[.3,.3,.3,1]}),GameConfig.attributes.add("colorEmpty",{type:"rgba",title:"Цвет: Пусто (Empty)",default:[1,1,1,1]}),GameConfig.attributes.add("textColorDefault",{type:"rgba",title:"Цвет текста: по умолчанию",default:[0,0,0,1]}),GameConfig.attributes.add("textColorEntered",{type:"rgba",title:"Цвет текста: после ввода",default:[1,1,1,1]}),GameConfig.instance=null,GameConfig.prototype.initialize=function(){GameConfig.instance=this},GameConfig.prototype.getColor=function(t){switch(t){case"correct":return this.colorCorrect;case"present":return this.colorPresent;case"absent":return this.colorAbsent;default:return this.colorEmpty}},GameConfig.prototype.getTextColor=function(t){return t?this.textColorEntered:this.textColorDefault};var ScaleCameraOrthoSize=pc.createScript("scaleCameraOrthoSize");ScaleCameraOrthoSize.attributes.add("camera",{type:"entity"}),ScaleCameraOrthoSize.attributes.add("refResolution",{type:"vec2",default:[1960,1200],title:"Reference Resolution",description:"Базовое разрешение экрана"}),ScaleCameraOrthoSize.attributes.add("refOrthoSize",{type:"number",default:5,title:"Reference Ortho Size",description:"Ортографический размер для базового разрешения"}),ScaleCameraOrthoSize.prototype.initialize=function(){this.prevWidth=this.app.graphicsDevice.width,this.prevHeight=this.app.graphicsDevice.height,this.updateOrthoSize()},ScaleCameraOrthoSize.prototype.update=function(){var e=this.app.graphicsDevice.width,t=this.app.graphicsDevice.height;e===this.prevWidth&&t===this.prevHeight||(this.prevWidth=e,this.prevHeight=t,this.updateOrthoSize())},ScaleCameraOrthoSize.prototype.updateOrthoSize=function(){var e=this.refResolution.x/this.refResolution.y,t=this.app.graphicsDevice.width/this.app.graphicsDevice.height;this.camera.camera.orthoHeight=t>e?this.refOrthoSize:this.refOrthoSize*(e/t)};var Loader=pc.createScript("loader");Loader.attributes.add("btnMob",{type:"entity"}),Loader.attributes.add("btnDesk",{type:"entity"}),Loader.attributes.add("buildNumber",{type:"number"}),Loader.prototype.initialize=function(){this.start()},Loader.prototype.initializeStart=function(){this.isMobile()?this.btnMob.element.on("click",this.start,this):this.btnDesk.element.on("click",this.start,this)},Loader.prototype.start=function(){this.isMobile()?this.loadScene("Game_Mobile"):this.loadScene("Game_Desktop")},Loader.prototype.isMobile=function(){return!!pc.platform.mobile},Loader.prototype.loadScene=function(t){this.app.scenes.changeScene(t)};var SaveSystem=pc.createScript("saveSystem");SaveSystem.instance=null,SaveSystem.prototype.data={coins:0,level:1,items:[],logs:null},SaveSystem.prototype.storageKey="myGameSave",SaveSystem.getInstance=function(){if(!SaveSystem.instance){console.warn("SaveSystem instance not found. Creating new one.");var e=new pc.Entity("SaveSystem");e.addComponent("script"),e.script.create("saveSystem"),pc.app.root.addChild(e)}return SaveSystem.instance},SaveSystem.prototype.initialize=function(){if(SaveSystem.instance)return console.warn("SaveSystem already exists"),void this.entity.destroy();SaveSystem.instance=this,this.load(),this.entity.reparent(null),window.addEventListener("beforeunload",this.save.bind(this))},SaveSystem.prototype.update=function(e){this.saveTimer||(this.saveTimer=0),this.saveTimer+=e,this.saveTimer>=5&&(this.save(),this.saveTimer=0)},SaveSystem.prototype.save=function(){try{var e=JSON.stringify(this.data);localStorage.setItem(this.storageKey,e)}catch(e){console.error("Failed to save:",e)}},SaveSystem.prototype.load=function(){try{var e=localStorage.getItem(this.storageKey);e&&(this.data=JSON.parse(e),console.log("[SaveSystem] Loaded:",this.data))}catch(e){console.error("Failed to load:",e)}};var ScaleRectByScreenWidth=pc.createScript("scaleRectByScreenWidth");ScaleRectByScreenWidth.attributes.add("scaleFactor",{type:"number",default:1,title:"Scale Factor",description:"Коэффициент масштабирования (от 0 до 1)"}),ScaleRectByScreenWidth.attributes.add("refResolution",{type:"vec2",default:[1920,1080],title:"Reference Resolution",description:"Базовое разрешение экрана"}),ScaleRectByScreenWidth.attributes.add("targetRects",{type:"entity",array:!0,title:"Target Rects",description:"Список целевых объектов для масштабирования"}),ScaleRectByScreenWidth.prototype.initialize=function(){this.initScales=[];for(var t=0;t<this.targetRects.length;t++){var e=this.targetRects[t];e&&(this.initScales[t]=e.getLocalScale().clone())}this.lastWidth=this.app.graphicsDevice.width,this.lastHeight=this.app.graphicsDevice.height,this.updateScale()},ScaleRectByScreenWidth.prototype.update=function(){var t=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height;t===this.lastWidth&&e===this.lastHeight||(this.lastWidth=t,this.lastHeight=e,this.updateScale())},ScaleRectByScreenWidth.prototype.updateScale=function(){var t=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height;if(0!==t&&0!==e){var i=this.refResolution.x/this.refResolution.y,a=t/e;if(a<i)for(var c=pc.math.lerp(1,a/i,this.scaleFactor),s=0;s<this.targetRects.length;s++){if(r=this.targetRects[s]){var h=this.initScales[s];r.setLocalScale(h.x*c,h.y*c,h.z)}}else for(s=0;s<this.targetRects.length;s++){var r;if(r=this.targetRects[s]){h=this.initScales[s];r.setLocalScale(h.x,h.y,h.z)}}}else this.app.once("postupdate",this.updateScale,this)};var Logger=pc.createScript("logger");Logger.instance=null,Logger.getInstance=function(){if(!Logger.instance){console.warn("Logger instance not found. Creating new one.");var t=new pc.Entity("Logger");t.addComponent("script"),t.script.create("logger"),pc.app.root.addChild(t)}return Logger.instance},Logger.prototype.initialize=function(){if(Logger.instance)return console.warn("Logger already exists"),void this.entity.destroy();Logger.instance=this,this.entity.reparent(null),this.exitLogs={type:"Exit",points:0},this.gameCompletedStats={type:"GameCompleted",points:0},window.addEventListener("beforeunload",this.exitGame.bind(this))},Logger.prototype.exitGame=function(){this.exitLogs.points=SaveSystem.getInstance().data.click,this.showLogs(this.exitLogs)},Logger.prototype.tempGame=function(){this.temp.points=SaveSystem.getInstance().data.click,this.showLogs(this.temp)},Logger.prototype.completedGame=function(){this.gameCompletedStats.points=SaveSystem.getInstance().data.click,this.showLogs(this.gameCompletedStats)},Logger.prototype.showLogs=function(t){console.log(JSON.parse(JSON.stringify(t)))};var Test=pc.createScript("test");Test.prototype.initialize=function(){console.log(SaveSystem.getInstance().data.coins)},Test.prototype.update=function(t){};var Cell=pc.createScript("cell");Cell.attributes.add("letterElement",{type:"entity"}),Cell.attributes.add("backgroundImage",{type:"entity"}),Cell.attributes.add("config",{type:"entity"}),Cell.prototype.initialize=function(){this.setLetter(""),this.setState("empty")},Cell.prototype.setLetter=function(t){if(this.letterElement&&this.letterElement.element){const e=this.letterElement.element,l=""!==t;e.text=t.toUpperCase(),e.color=this.config.script.gameConfig.getTextColor(!l)}},Cell.prototype.setState=function(t){this.letterElement.element.color=this.config.script.gameConfig.getTextColor(!0);const e=this.config.script.gameConfig.getColor(t);this.backgroundImage&&this.backgroundImage.element&&(this.backgroundImage.element.color=e)},Cell.prototype.shake=function(){const t=this.entity;let e=0;const l=setInterval((()=>{const o=e%2==0?1.05:.95;t.setLocalScale(o,1,1),e++,e>6&&(clearInterval(l),t.setLocalScale(1,1,1))}),40)};var Row=pc.createScript("row");Row.attributes.add("cells",{type:"entity",array:!0}),Row.prototype.initialize=function(){this.clear()},Row.prototype.setLetterAt=function(t,e){this.cells[t]&&this.cells[t].script&&this.cells[t].script.cell&&this.cells[t].script.cell.setLetter(e)},Row.prototype.setStateAt=function(t,e){this.cells[t]&&this.cells[t].script&&this.cells[t].script.cell&&this.cells[t].script.cell.setState(e)},Row.prototype.setWordWithStates=function(t,e){for(let s=0;s<5;s++)this.setLetterAt(s,t[s]),this.setStateAt(s,e[s])},Row.prototype.clear=function(){for(let t=0;t<this.cells.length;t++)this.setLetterAt(t,""),this.setStateAt(t,"empty")},Row.prototype.revealResult=function(t,e,s){for(let l=0;l<this.cells.length;l++){const i=this.cells[l],c=t[l],o=e[l];setTimeout((()=>{i.script.cell.setLetter(c),i.script.cell.setState(o),l===this.cells.length-1&&"function"==typeof s&&setTimeout((()=>{s()}),300)}),150*l)}},Row.prototype.shake=function(){for(let t=0;t<this.cells.length;t++)this.cells[t].script.cell.shake()};var Keyboard=pc.createScript("keyboard");Keyboard.attributes.add("keys",{type:"entity",array:!0,title:"Кнопки клавиатуры"}),Keyboard.prototype.updateKeyColor=function(e,t){const o={correct:new pc.Color(.2,.7,.2),present:new pc.Color(.8,.8,.2),absent:new pc.Color(.3,.3,.3)};for(let r=0;r<this.keys.length;r++){const n=this.keys[r].script.keyButton;if(!n||"letter"!==n.keyType)continue;const s=n.textElement?.element;if(!s)continue;if(s.text.trim().toUpperCase()===e.toUpperCase()){n.setColor(o[t]||new pc.Color(1,1,1));break}}},Keyboard.prototype.resetColors=function(){const e=GameConfig.instance?GameConfig.instance.getColor("empty"):new pc.Color(1,1,1);for(let t=0;t<this.keys.length;t++){const o=this.keys[t];o.script.keyButton&&o.element&&(o.element.color=e)}};var KeyButton=pc.createScript("keyButton");KeyButton.attributes.add("keyType",{type:"string",enum:[{letter:"letter"},{enter:"enter"},{backspace:"backspace"}],title:"Тип клавиши"}),KeyButton.attributes.add("textElement",{type:"entity",title:"Элемент с буквой (Text)"}),KeyButton.prototype.initialize=function(){this.entity.element&&this.entity.element.on("mousedown",this.onClick,this)},KeyButton.prototype.onClick=function(){if("letter"===this.keyType){if(!this.textElement||!this.textElement.element)return;const t=this.textElement.element.text.trim().toUpperCase();this.app.fire("letter",t)}else"enter"===this.keyType?this.app.fire("enter"):"backspace"===this.keyType&&this.app.fire("backspace")},KeyButton.prototype.setColor=function(t){this.entity.element&&(this.entity.element.color=t)};var Wordle=pc.createScript("wordle");Wordle.attributes.add("rows",{type:"entity",array:!0,title:"Строки (Rows)"}),Wordle.attributes.add("keyboard",{type:"entity",title:"Клавиатура"}),Wordle.attributes.add("levelWords",{type:"string",array:!0,title:"Слова по уровням"}),Wordle.attributes.add("levelTextEntity",{type:"entity",title:"Текст уровня"}),Wordle.prototype.initialize=function(){this.currentRow=0,this.currentGuess="",this.maxLetters=5,this.level=0,this.setLevel(this.level),this.app.on("letter",this.addLetter,this),this.app.on("backspace",this.removeLetter,this),this.app.on("enter",this.submitGuess,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},Wordle.prototype.destroy=function(){this.app.keyboard.off(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.off("letter",this.addLetter,this),this.app.off("backspace",this.removeLetter,this),this.app.off("enter",this.submitGuess,this)},Wordle.prototype.setLevel=function(t){if(t>=this.levelWords.length)return console.log("🎉 Все уровни пройдены!"),void(this.levelTextEntity.element.text="🎉 Победа!");this.level=t,this.target=this.levelWords[t].trim().toUpperCase(),this.levelTextEntity.element.text="Уровень "+(t+1),this.currentRow=0,this.currentGuess="";for(let t=0;t<this.rows.length;t++)this.rows[t].script.row.clear();this.keyboard?.script?.keyboard?.resetColors&&this.keyboard.script.keyboard.resetColors(),console.log("➡️ Загадано слово:",this.target)},Wordle.prototype.addLetter=function(t){if(this.currentGuess.length>=this.maxLetters)return;const e=t.toUpperCase();this.currentGuess+=e,this.rows[this.currentRow].script.row.setLetterAt(this.currentGuess.length-1,e)},Wordle.prototype.removeLetter=function(){0!==this.currentGuess.length&&(this.currentGuess=this.currentGuess.slice(0,-1),this.rows[this.currentRow].script.row.setLetterAt(this.currentGuess.length,""))},Wordle.prototype.submitGuess=function(){if(this.currentGuess.length!==this.maxLetters)return;const t=this.currentGuess.toUpperCase();this.validateWordOnline(t,(e=>{if(!e)return void this.onInvalidWord(t);const s=this.checkGuess(t);this.rows[this.currentRow].script.row.revealResult(t,s,(()=>{t===this.target?(console.log("✅ Уровень пройден!"),this.setLevel(this.level+1)):(this.currentRow++,this.currentGuess="",this.currentRow>=this.rows.length&&(console.log("💀 Попытки закончились. Было слово: "+this.target),this.levelTextEntity.element.text="❌ Слово: "+this.target))}))}))},Wordle.prototype.onInvalidWord=function(t){console.log("⚠️ Неверное слово:",t),this.rows[this.currentRow].script.row.shake()},Wordle.prototype.checkGuess=function(t){const e=Array(this.maxLetters).fill("absent"),s=this.target.split(""),r=t.split("");for(let t=0;t<this.maxLetters;t++)r[t]===s[t]&&(e[t]="correct",s[t]=null);for(let t=0;t<this.maxLetters;t++){if("correct"===e[t])continue;const i=s.indexOf(r[t]);-1!==i&&(e[t]="present",s[i]=null)}return e},Wordle.prototype.validateWordOnline=function(t,e){const s=`https://testapi-6b63.onrender.com/check?word=${encodeURIComponent(t)}`;fetch(s).then((t=>t.json())).then((t=>{const s=!0===t.exists;e(s)})).catch((t=>{console.error("Ошибка при проверке слова:",t),e(!1)}))},Wordle.prototype.onKeyDown=function(t){if(this.currentRow>=this.rows.length)return;const e=t.event.key.toLowerCase();if(t.key===pc.KEY_ENTER)return void this.app.fire("enter");if(t.key===pc.KEY_BACKSPACE)return void this.app.fire("backspace");const s={q:"Й",w:"Ц",e:"У",r:"К",t:"Е",y:"Н",u:"Г",i:"Ш",o:"Щ",p:"З",a:"Ф",s:"Ы",d:"В",f:"А",g:"П",h:"Р",j:"О",k:"Л",l:"Д",z:"Я",x:"Ч",c:"С",v:"М",b:"И",n:"Т",m:"Ь","[":"Х","]":"Ъ",";":"Ж","'":"Э",",":"Б",".":"Ю","`":"Ё"};s[e]?this.app.fire("letter",s[e]):/^[а-яё]$/i.test(e)&&this.app.fire("letter",e.toUpperCase())};